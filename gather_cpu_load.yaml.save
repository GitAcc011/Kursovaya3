---
- name: Gather CPU load
  hosts: all

  vars:
  - min_cpu_load
- min_cpu_load
  - inventory_hostname
  - free_mem
  - inventory_hostname

  tasks:
    - name: Get load
      shell: "free -m | awk '/Mem:/ { print $4 }'"
      register: free_mem

    - name: Create file
      
  
    - name: Save to file "memory_info"
      local_action:
        module: lineinfile
        path: ./memory_info.txt
        line: "{{ inventory_hostname }} {{ free_mem.stdout }}"
      run_once: false
